# Aggregator
The aggregator library's purpose is to facilitate AB2D aggregation of files generated by the AB2D
worker into files the user can download. It does this by monitoring a directory that AB2D uses
to write out EOBs for a batch of beneficiaries. Once enough files have been generated or the job is
done, it combines the contents of a file to a contract file that a user could download. This allows
multiple threads to write their own file without interfering with each other and then have this aggregator
clean up the results.

## Process explanation

Communication between the AB2D worker application and the aggregator is currently done exclusively through the file system
of the EFS mount. 

The worker creates all the necessary directories by using JobHelper.workerSetUpJobDirectories(jobId). This creates
three directories:
- ${efs.mount}/{jobId} - the top level job directory
- ${efs.mount}/{jobId}/${job.file.streaming} - the location to place files that are currently open and being streamed 
by the worker. The aggregator assumes there are more files to come as long as this directory still exists.
- ${efs.mount}/{jobId}/${job.file.finished} - the location to place files that the AB2D worker has finished writing to.
Placing them in this directory indicates that the file is ready to be aggregated.

When all the files have been written to the finished directory, the AB2D worker calls JobHelper.workerFinishJob(jobId).
This will delete the streaming directory

When the aggregator is finished aggregating all files, it calls JobHelper.aggregatorFinishJob(jobId). This will delete
the finished directory. This is how the worker knows the aggregator is done.

The StatusManager class provides convenience operations to check the status of the job (is job done streaming or is job
aggregated)